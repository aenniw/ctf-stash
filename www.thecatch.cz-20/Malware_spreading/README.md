#### Challenge:

Hi, executive senior investigator!

We suspect that the malware is primarily spreaded somehow by e-mail. We have partial traffic dump from one small company, that was attacked. Try to check this hypothesis. [malware_spreading.tar.xz](./malware_spreading.tar.xz ":ignore")

Good Luck!

---

#### Solution:

We stumbled upon solution of this challenge by lucky inspection and carving of the provided `PCAP`, so instead of how we did it I will write how we should have done it. This challenge can be beautifully solved by using the tool [NetworkMiner](https://www.netresec.com/?page=Networkminer). After [installing](https://www.netresec.com/?page=Blog&month=2014-02&post=HowTo-install-NetworkMiner-in-Ubuntu-Fedora-and-Arch-Linux) it we need to convert the provided `PCAP` from newer `PcapNG` format to older original `PCAP` format with following command:

```bash
editcap -F libpcap malware_spreading.pcap malware_spreading_fixed.pcap
```

Then open `malware_spreading_fixed.pcap` in `NetworkMiner`:

```bash
mono NetworkMiner.exe --noupdatecheck .
```

Filtering out unnecessary clutter we notice following suspicious chain of emails:

```email
From: Lorem Ipsum <lorem@genuine-national-lottery.cz>
To: Alice Nelson <alice@cypherfix.cz>
Subject: Special offer

Dear customer,
I'm IT specialist in The Nation Lottery and I have an exciting offer for you! I can tell you in advance which numbers will be drawn!

I can't win it myself, because it will be very suspicious. I will tell you the secret if you promise to give me 30 % of the prize. I trust you, so no payment in advance, no credit cards or other deceptions.

If you agree, register to our newsletter at news.genuine-national-lottery.cz.

Kind regards
Lorem Ipsum
```

```email
From: Lorem Ipsum <lorem@genuine-national-lottery.cz>
To: Alice Nelson <alice@cypherfix.cz>
Subject: The prediction

Dear Alice,
I know it - you are the right person to cooperate. The numbers you are looking for, are in attachment. The password was send on your cell. Enjoy your (our) prize!

Lorem
```

```email
From: Lorem Ipsum <lorem@genuine-national-lottery.cz>
To: Alice Nelson <alice@cypherfix.cz>
Subject: The prediction

Dear Alice,
I know it - you are the right person to cooperate. The numbers you are looking for, are in attachment. The password was send on your cell. Enjoy your (our) prize!

Lorem

attachment; filename=<winning_numbers.zip>
```

```email
From: Alice Nelson <alice@cypherfix.cz>
To: John Johnson <john@cypherfix.cz>
Subject: Rich rich rich! :-D

Johnny, I need your help!
I got the winning lottery numbers and we can be really rich :) But my computer is too slow or entro-something is wrong inside and it can't show me the numbers :(. I left a flash drive on your desk, run the only file that's there and gimme the results.
Thanks and see ya!
A.

--
Alice Nelson
Senior assistant of executive vice-president
alice@cypherfix.cz
+420 555 25 69 04
```

```email
From: Alice Nelson <alice@cypherfix.cz>
To: John Johnson <john@cypherfix.cz>
Subject: Rich and stupid :)

Oh my, you will need the secret 'HappyWinner-paSSw00rd42'. See ya! A.
--
Alice Nelson
Senior assistant of executive vice-president
alice@cypherfix.cz
+420 555 25 69 04
```

Unzipping `winning_numbers.zip` with the password `HappyWinner-paSSw00rd42` will get us a spreadsheet. When opened, the main sheet notes that it needs to have macros enabled. Reopening the sheet with enabled macros reveals the flag.

---

<details><summary>FLAG:</summary>

```
FLAG{rUn5-GwMR-IlY6-orZd}
```

</details>
<br/>
