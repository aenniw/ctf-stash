#### Challenge:

A friend sent [this](./Elixir.Bananas.beam ":ignore") to me. Can you help me find out what they want?

`nc challs.actf.co 31403`


---

#### Solution:

- reversing the binary via reveals what we are expected to pass as input `elixir` can be simply reversed via
```
docker run --rm -it -v $(pwd):/work -w /work erlang:25
1> file:write_file("./Elixir.Bananas.erl", io_lib:fwrite("~p.\n", [beam_disasm:file("./Elixir.Bananas.beam")])).
```

```erlang
{beam_file,'Elixir.Bananas',
    [{'__info__',1,2},
     {main,0,16},
     {main,1,18},
     {module_info,0,26},
     {module_info,1,28}],
    [{vsn,[84161024486585888335868361769801237040]}],
    [{version,"8.2.3"},
     {options,
         [no_spawn_compiler_process,from_core,no_core_prepare,no_auto_import]},
     {source,
         "/Users/alexahunleth/experiments/cybersec_challs/bananas/lib/bananas.ex"}],
    [{function,'__info__',1,2,
         [{label,1},
          {line,0},
          {func_info,{atom,'Elixir.Bananas'},{atom,'__info__'},1},
          {label,2},
          {select_val,
              {x,0},
              {f,9},
              {list,
                  [{atom,attributes},
                   {f,8},
                   {atom,compile},
                   {f,8},
                   {atom,deprecated},
                   {f,7},
                   {atom,exports_md5},
                   {f,6},
                   {atom,functions},
                   {f,5},
                   {atom,macros},
                   {f,7},
                   {atom,md5},
                   {f,8},
                   {atom,module},
                   {f,4},
                   {atom,struct},
                   {f,3}]}},
          {label,3},
          {move,{atom,nil},{x,0}},
          return,
          {label,4},
          {move,{atom,'Elixir.Bananas'},{x,0}},
          return,
          {label,5},
          {move,{literal,[{main,0},{main,1}]},{x,0}},
          return,
          {label,6},
          {move,
              {literal,
                  <<84,192,125,207,218,124,186,54,254,16,205,12,29,5,146,131>>},
              {x,0}},
          return,
          {label,7},
          {move,nil,{x,0}},
          return,
          {label,8},
          {move,{x,0},{x,1}},
          {move,{atom,'Elixir.Bananas'},{x,0}},
          {call_ext_only,2,{extfunc,erlang,get_module_info,2}},
          {label,9},
          {call_only,1,{'Elixir.Bananas','-inlined-__info__/1-',1}}]},
     {function,check,1,11,
         [{line,1},
          {label,10},
          {func_info,{atom,'Elixir.Bananas'},{atom,check},1},
          {label,11},
          {test,is_nonempty_list,{f,12},[{x,0}]},
          {get_list,{x,0},{x,1},{x,0}},
          {test,is_eq_exact,{f,12},[{x,0},{literal,[<<"bananas">>]}]},
          {line,2},
          {gc_bif,'+',{f,0},2,[{x,1},{integer,5}],{x,0}},
          {gc_bif,'*',
              {f,0},
              1,
              [{tr,{x,0},{number,0,18446744073709551615}},{integer,9}],
              {x,0}},
          {gc_bif,'-',
              {f,0},
              1,
              [{tr,{x,0},{number,0,18446744073709551615}},{integer,1}],
              {x,0}},
          {bif,'==',
              {f,0},
              [{tr,{x,0},{number,0,18446744073709551615}},{integer,971}],
              {x,0}},
          return,
          {label,12},
          {move,{atom,false},{x,0}},
          return]},
     {function,convert_input,1,14,
         [{line,3},
          {label,13},
          {func_info,{atom,'Elixir.Bananas'},{atom,convert_input},1},
          {label,14},
          {allocate,0,1},
          {line,4},
          {call_ext,1,{extfunc,'Elixir.String',trim,1}},
          {line,5},
          {call_ext,1,{extfunc,'Elixir.String',split,1}},
          {call_last,1,{'Elixir.Bananas',to_integer,1},0}]},
     {function,main,0,16,
         [{line,6},
          {label,15},
          {func_info,{atom,'Elixir.Bananas'},{atom,main},0},
          {label,16},
          {move,nil,{x,0}},
          {call_only,1,{'Elixir.Bananas',main,1}}]},
     {function,main,1,18,
         [{line,6},
          {label,17},
          {func_info,{atom,'Elixir.Bananas'},{atom,main},1},
          {label,18},
          {allocate,0,0},
          {move,{literal,<<"How many bananas do I have?\n">>},{x,0}},
          {line,7},
          {call_ext,1,{extfunc,'Elixir.IO',gets,1}},
          {line,8},
          {call,1,{'Elixir.Bananas',convert_input,1}},
          {line,9},
          {call,1,{'Elixir.Bananas',check,1}},
          {call_last,1,{'Elixir.Bananas',print_flag,1},0}]},
     {function,print_flag,1,20,
         [{line,10},
          {label,19},
          {func_info,{atom,'Elixir.Bananas'},{atom,print_flag},1},
          {label,20},
          {test,is_eq_exact,{f,21},[{x,0},{atom,true}]},
          {allocate,0,0},
          {move,{literal,<<"flag.txt">>},{x,0}},
          {line,11},
          {call_ext,1,{extfunc,'Elixir.File','read!',1}},
          {line,12},
          {call_ext_last,1,{extfunc,'Elixir.IO',puts,1},0},
          {label,21},
          {move,{literal,<<"Nope">>},{x,0}},
          {line,13},
          {call_ext_only,1,{extfunc,'Elixir.IO',puts,1}}]},
     {function,to_integer,1,23,
         [{line,14},
          {label,22},
          {func_info,{atom,'Elixir.Bananas'},{atom,to_integer},1},
          {label,23},
          {test,is_nonempty_list,{f,24},[{x,0}]},
          {get_list,{x,0},{x,1},{x,2}},
          {test,is_nonempty_list,{f,24},[{x,2}]},
          {get_tl,{x,2},{x,3}},
          {test,is_nil,{f,24},[{x,3}]},
          {allocate,1,3},
          {move,{x,2},{y,0}},
          {move,{x,1},{x,0}},
          {line,15},
          {call_ext,1,{extfunc,erlang,binary_to_integer,1}},
          {test_heap,2,1},
          {put_list,{x,0},{y,0},{x,0}},
          {deallocate,1},
          return,
          {label,24},
          return]},
     {function,module_info,0,26,
         [{line,0},
          {label,25},
          {func_info,{atom,'Elixir.Bananas'},{atom,module_info},0},
          {label,26},
          {move,{atom,'Elixir.Bananas'},{x,0}},
          {call_ext_only,1,{extfunc,erlang,get_module_info,1}}]},
     {function,module_info,1,28,
         [{line,0},
          {label,27},
          {func_info,{atom,'Elixir.Bananas'},{atom,module_info},1},
          {label,28},
          {move,{x,0},{x,1}},
          {move,{atom,'Elixir.Bananas'},{x,0}},
          {call_ext_only,2,{extfunc,erlang,get_module_info,2}}]},
     {function,'-inlined-__info__/1-',1,30,
         [{line,0},
          {label,29},
          {func_info,{atom,'Elixir.Bananas'},{atom,'-inlined-__info__/1-'},1},
          {label,30},
          {jump,{f,29}}]}]}.
```

- in the course we see that in `main` we read the user input convert it and compare against magic value, if we guessed that we get the flag
  - `convert_input` will `trim` the input and the `split` it by ` ` 
  - `to_integer` will re-orders the elements and parses int from the last element
  - `check` will compare the array if the first element is equal to `bananas` and if the `int` passes following equation `((x + 5) * 9) - 1 = 971`
- with the information mentioned above we can revers the check and just paste the `103 bananas` in to remote server

---

<details><summary>FLAG:</summary>

```
actf{baaaaannnnananananas_yum}
```

</details>
<br/>
